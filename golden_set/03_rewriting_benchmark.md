## Практический кейс по планированию ресурсов

Исходные требования:

* Объектов в каталоге: 1 млн. (650 тыс. пользователей, 350 тыс. групп).
* Обслуживаемых пользователей: 2 тыс.

Расчеты:

Для размещения файлов операционной системы и каталога на жестком диске потребуется не менее 60 ГБ HDD:

```Plain Text
HDD = 50 + 1 000 000/20 000 ≈ 100 GB
```

Для того, чтобы контроллер домена (КД) смог разместить каталог с 1 млн. объектов в оперативной памяти, ему потребуется не менее 100 ГБ ОЗУ:

```Plain Text
RAM = 3 + 1 000 000/20 000 ≈ 66 GB
```

Если к контроллеру будут обращаться 2 тысячи пользователей, то ему потребуется не менее 3 потоков:

```Plain Text
CP Us = 1 + 2 000/1 000 = 3
```

Конкретно к этому серверу будет обращаться 2 тыс. пользователей, поэтому достаточно одной виртуальной машины. Но если нужно будет обеспечить единовременную работу всех 600 тысяч пользователей, то потребуется не менее 300 таких контроллеров и более целесообразным будет увеличить производительности контроллеров до 10 тысяч пользователей (8-12 потоков ЦПУ), тогда количество контроллеров можно будет сократить до 60 единиц.
Следует учесть, что объекты в каталоге создаются в среднем со скоростью один объект в секунду и это значение растет по мере увеличения количества объектов в каталоге, поэтому на создание 1 млн. объектов уйдет не менее 11 дней. Ускорить процесс можно увеличением числа потоков, но зависимость будет нелинейной, т.к. потоки будут конкурировать за общие ресурсы.
Дополнительного ускорения процедуры можно достичь путем создания пользователей на нескольких контроллерах одновременно, т.к. при репликации вычислительных ресурсов требуется меньше, чем при создании объектов.
Для тестирования остальных подсистем в соответствии с типовой схемой нужно дополнительно 8 виртуальных машин: 2 ЦПУ, 4 ГБ ОЗУ, 100 ГБ HDD (DHCP, установка ОС по сети, сервер печати, сервер общего доступа к файлам, сервер аудита, сервер мониторинга, сервер репозиториев, клиентская машина).





## Настройка сетевого интерфейса

Если операционная система установлена с графическим интерфейсом fly-wm, то в качестве менеджера сетевых подключений устанавливается служба NetworkManager. На серверах ее нужно отключить:

```Linux
sudo systemctl stop NetworkManager
sudo systemctl disable NetworkManager
sudo systemctl mask NetworkManager
sudo systemctl status NetworkManager
```

После выполнения последней команды в терминале должна отобразиться информация о маскировке службы NetworkManager:

```Linux
o NetworkManager.service
Loaded: masked (Reason: Unit NetworkManager.service is masked.)
Active: inactive (dead) since Tue 2024-10-29 18:16:15 MSK; 3min 35s ago
Main PID: 493 (code=exited, status=0/SUCCESS)
...
```

После отключения службы **NetworkManager** сетевые настройки задаются в файлах `/etc/network/interfaces` и `/etc/resolv.conf`. Файл `resolv.conf` используется DNS-клиентом, а файл `interfaces` – утилитами `ifup` и `ifdown` для конфигурирования сетевых интерфейсов.
Так как служба каталога интегрирована со службой разрешения имен, то контроллер домена выступает еще и в роли DNS-сервера. Адреса DNS-серверов устанавливаются на доменных компьютерах вручную или через DHCP. Поэтому на контроллерах домена рекомендуется использовать только статические IP-адреса. Отредактировать файл конфигурации можно с помощью редактора `nano`:

```Linux
sudo nano /etc/network/interfaces
```

Пример настройки сетевого интерфейса на контроллере домена для использования статического IP-адреса:

```Linux
auto lo
iface lo inet loopback
auto eth0
iface eth0 inet static address 10.0.1.11 netmask 255.255.255.0 gateway 10.0.1.1
```

где:

* `auto eth0` — указывает, что интерфейс eth0 включается автоматически при выполнении команды `ifup -a`. Список доступных интерфейсов можно посмотреть командой `ip a`, интерфейс сетевой карты обычно имеет идентификатор `eth0`.
* `iface eth0 inet static` — строка, начинающаяся с директивы iface, объединяет группу строк, отвечающих за настройку указанного сетевого интерфейса:
    * `eth0` - определяет имя интерфейса;
    * `inet` - указывает, что следует использовать IPv4. Также может принимать значение inet6 для IPv6 соответственно;
    * `static` - указывает, что настройки интерфейса задаются вручную. Также может принимать значение dhcp для динамической настройки с помощью DHCP-сервера.
* `address`, `netmask`, `gateway` — задают IP-адрес, маску и шлюз по умолчанию для интерфейса, указанного в строке `iface`.

Для применения новых настроек, необходимо перезапустить службу Networking и очистить старое соединение командой `flush` утилиты `ip`.

> **Внимание:** Если доступ к компьютеру осуществляется исключительно удалённо, например, посредством протоколов SSH или RDP, то чтобы избежать возможной утраты соединения, вместо команды flush рекомендуется выполнить простую перезагрузку системы при помощи команды `sudo reboot`.

```Linux
sudo ip addr flush dev eth0
sudo systemctl restart networking
```

Для возможности обращения к публичным репозиториям следует настроить функцию разрешения имен. В файле `/etc/resolv.conf` рекомендуется указать бесплатный сервер разрешения имен от Яндекс:

```Linux
sudo nano /etc/resolv.conf
```

Изменить содержимое файла:

```Linux
nameserver 77.88.8.8
```

После установки настроек необходимо проверить подключение к репозиториям `ALSE`:

```Linux
ping -c 4 dl.astralinux.ru
```

> **Примечание:** Если продукт нужно установить в закрытом контуре без доступа в Интернет, необходимо воспользоваться установочным диском или локальным репозиторием.





## Дополнительные настройки DNS

Для корректной работы сервера необходимо отключить **DNSSEC**. Для его отключения в файле `/etc/bind/ipa-options-ext.conf` параметру `dnssec-validation` нужно присвоить значение `no`.
Особенностью настроек службы `bind9-pkcs11` по умолчанию является запрет на обработку рекурсивных DNS-запросов от клиентов, находящихся за пределами той же подсети, в которой находится сам DNS-сервер. Сделано это для предотвращения DDoS-атак с DNS-усилением, но эта защита не актуальна для контроллеров домена, которые работают в закрытом периметре, поэтому в файле `ipa-options-ext.conf` рекомендуется задать также значение `any` для параметров `allow-recursion` и `allow-query-cache` или определить в файле `/etc/bind/ipa-ext.conf` список доверенных сетей.

После внесения изменений содержимое файла `/etc/bind/ipa-options-ext.conf` должно быть следующим:

```Plain Text
allow-recursion { any; };
allow-query-cache { any; };
dnssec-validation no;
```

Для проверки конфигурационного файла `bind9` после изменений использовать команду:

```Linux
sudo named-checkconf /etc/bind/named.conf
```

Для применения изменений требуется перезапустить DNS-службу:

```Linux
sudo systemctl restart bind9-pkcs11.service
```

Несмотря на то, что `bind9-pkcs11` может успешно выступать в роли распознавателя, для снижения нагрузки с DNS-сервера эту функцию рекомендуется передать стороннему сервису, например, публичным DNS-серверам от Яндекс, которые доступны по IP-адресу `77.88.8.8`.
Для настройки перенаправления DNS-запросов на портале управления **Роли и службы сайта → Служба разрешения имен → Глобальная конфигурация DNS** нужно добавить запись с политикой **Только перенаправлять** или **Сначала перенаправлять**, см. Глобальная конфигурация DNS.
Создание обратной DNS-зоны подробно описано в разделе **Роли и службы сайта → Служба разрешения имен → Зоны DNS → Создание зоны DNS** Руководства администратора. Часть 2. Важно помнить, что по умолчанию обратная зона создается с маской с размерностью `/24`, игнорируя настройки сетевого адаптера. Если подсеть отличается от размерности `/24`, то необходимо вручную создать обратную зону нужной размерности, а созданную по умолчанию - выключить.





## Навык «Техподдержка»

Навык «Техподдержка» реализуется модулем **ЦА.Техподдержка**. Данный навык реализует механизм определения во входящих вопросах запросы, которые могут трактоваться как запросы в техническую поддержку. Запросы проходя классификацию в соответствии с настроенными тематиками обращений. ЦА реализует опрос пользователя, выясняет параметры, требуемые для формирования обращения в техническую поддержку в соответствии с определенным Системой классом запроса, и в результате отправляет обращение на почту технической поддержки или в API системы техподдержки (Service Desk).

При настройке навыка «техподдержка» администратор указывает для каждого обращения:

1.	**Имя.** Имя может быть любым символьным значением и предназначено для того, чтобы администратор Системы мог идентифицировать настройки класса обращения.
2.	**Описание.** Представляет собой словесное описание тематики обращения, которая должна быть обработана в соответствии с настраиваемым сценарием. Необходимо указывать описание наиболее точно, т.к. данное описание будет использоваться Системой для классификации обращений.
3.	**Критерии для прекращения работы чат-бота (Выход из чата).** Задаются условия, при которых Система должна прервать формирование обращения в техническую поддержку и вернуться к режиму ответов на вопросы пользователя.
4.	**Отправить шаблон обращения** на почту или создать обращение в ServiceDesk (Исполнитель обращения). Выбирается путь отправки обращения: на почту технической поддержки или в API технической поддержки (Service Desk).
5.	**Почту**, на которую будет направлен заполненный шаблон (Почта)/
6.	**Список атрибутов**, которые пользователь должен сообщить Системе (например, ФИО, Почта, номер обращения, если ранее уже были обращения) для полного формирования обращения и завершения передачи данных в техническую поддержку.





## Навык «Голос-текст»
Данный навык реализуется с помощью модуля **ЦА.Голос2Текст** и предназначен для получения и обработки голосовых команд пользователя.
При настройке навыка «голос-текст» администратор указывает:

* **Поле «Температура»** управляет степенью непредсказуемости в выводах модели. Использование этого параметра позволяет балансировать между точностью и креативностью генерации текста.
* **Модель для распознавания**. В настоящей версии Системы для распознавания голоса доступна одна модель **ASR**.
* **Тип ответа на голосовую запись** (транскрибирование или ответ на голосовой запрос). Определяет, какую реакцию для пользователя должна сформировать Система при получении голосового запроса.

Доступны следующие варианты реакции:

* *«Расшифровать»*. При выборе данной реакции Система преобразует входящий голосовой запрос в текст и предоставит расшифровку пользователю.
* *«Ответить на расшифрованный текст»*. При выборе данной реакции Система преобразует входящий голосовой запрос в текст и выполнит запрос, как если бы он изначально был бы текстовым.





## Монитор системы защиты

Программа **Монитор системы защиты** предназначена для отображения состояния системы защиты, а также для быстрого вызова функций управления системой защиты. Файл программы `GTray.exe` расположен в папке пользовательских программ. Программа **Монитор системы защиты** автоматически запускается при загрузке операционной системы и отображает значок программы в системном лотке, находящемся в правой нижней части панели задач. Значок программы зависит от режима, в котором работает система защиты.

При нажатии правой клавиши мыши на значке появляется контекстное меню, позволяющее запустить некоторые сервисные функции системы защиты:

* **Останов** — Останавливает механизмы системы защиты до перезагрузки системы или до их запуска.
* **Запуск** — Запускает механизмы системы защиты в штатном режиме.
* **Включение/Отключение ЗПС** — Включает или отключает механизм замкнутой программной среды.
* **Режим автозапуска...** — Включает или отключает режимы автозапуска.
* **Режим блокировки** — Включает или отключает режим блокировки.
* **Менеджер файлов** — Запускает программу Менеджер файлов.
* **Менеджер файлов (администратор)** — Запускает программу Менеджер файлов в режиме одобрения администратором.
* **Просмотр процессов** — Запускает программу Просмотр процессов.
* **Сетевое развертывание** — Запускает программу Сетевое развертывание.
* **Консоль управления** — Запускает программу Консоль управления.
* **О программе...** — Показывает сведения о программе.





## Подсистема регистрации

Подсистема регистрации кроме регистрации запросов на доступ к ресурсам компьютера также обеспечивает их хранение и возможность выборочного ознакомления с регистрационной информацией. Хранение зарегистрированных событий системы защиты осуществляется в файле журнала событий, который расположен по пути `%SystemRoot%\Guard\GReport.mdb` и имеет формат базы данных Microsoft Access.

Работа с журналом событий осуществляется с помощью вкладки **Журнал событий** программы **Консоль управления**, перейдя в которую администратор системы защиты может выполнять следующие функции:

* просмотр списка событий;
* просмотр свойств выбранного события;
* применение фильтра при просмотре списка событий;
* сортировка событий по основным полям;
* поиск событий в журнале по любому из критериев;
* сохранение журнала или отдельной выборки событий;
* очистка журнала.

При открытии вкладки **Журнал событий** программы **Консоль управления** в основном окне отображается список событий.

Список событий представляет собой таблицу, содержащую следующие поля:

* **Тип события** — Определяет тип события (уведомление, предупреждение, ошибка).
* **Дата** — Определяет дату и время события.
* **Имя пользователя** — Определяет имя пользователя, от имени которого произошло событие.
* **Имя компьютера** — Определяет имя компьютера, на котором произошло событие.
* **Событие** — Определяет название события.
* **Имя процесса** — Определяет имя процесса-источника события.
* **Имя объекта** — Определяет имя объекта.
* **Гриф объекта** — Определяет метку конфиденциальности объекта.
* **Допуск процесса** — Определяет текущий допуск процесса-источника события.
* **Дополнительно** — Определяет дополнительную информацию о событии.

Инструменты таблицы списка событий позволяют менять порядок и ширину столбцов, сортировать записи, а также позволяет отображать только те столбцы, которые наиболее важны для администратора. Порядок отображения столбцов меняется путём перетаскивания их мышью. Для настройки списка отображаемых столбцов необходимо вызвать контекстное меню заголовка списка событий и выбрать пункт меню **Столбцы**. В данном меню администратор системы защиты может отметить те столбцы, которые будут отображаться в списке событий.





## Получение пакетов

Получение пакетов осуществляется с источника, выбранного на этапе начальной загрузки. При сетевой установке (по протоколу FTP или HTTP) время выполнения этого шага будет зависеть от скорости соединения и может быть значительно большим, чем при установке с дистрибутивного DVD-диска.
Начиная с этого шага, программа установки работает с файлами только что установленной базовой системы. Все последующие изменения можно будет совершить после завершения установки посредством редактирования соответствующих конфигурационных файлов или при помощи модулей управления, включённых в дистрибутив.
Загрузчик — программа, которая позволяет загружать установленные операционные системы. При автоматическом разбиении разделов накопителя на жестких дисках средства вычислительной техники загрузчик автоматически устанавливается в начальный раздел диска.
Если же планируется использовать и другие операционные системы, уже установленные на этом компьютере, тогда имеет значение, на каком жёстком диске или разделе будет расположен загрузчик. В большинстве случаев программа установки правильно подберёт расположение загрузчика.
После выполнения копирования файлов РЕД ОС и установки загрузчика пользователю предлагается произвести перезагрузку РЕД ОС кнопкой **«Перезагрузить»**.





## DNF

Репозитории, с которыми работает DNF, отличаются от обычного набора пакетов наличием мета информации - индексов пакетов, содержащихся в репозитории, и сведений о них. Поэтому, чтобы получить всю информацию о репозитории, DNF достаточно получить его индексы.
DNF может работать с любым количеством репозиториев одновременно, формируя единую информационную базу обо всех содержащихся в них пакетах. При установке пакетов DNF обращает внимание только на название пакета, его версию и зависимости, а расположение в том или ином репозитории не имеет значения. Если потребуется, DNF в рамках одной операции установки группы пакетов может пользоваться несколькими репозиториями.

> **Важно!** При использовании сертифицированной версии ОС запрещается настройка служб автоматического обновления на использование внешних сторонних репозиториев операционных систем.

DNF позволяет взаимодействовать с репозиторием с помощью различных протоколов доступа. Наиболее популярные - HTTP и FTP, однако существуют и некоторые дополнительные методы.

Для того чтобы DNF мог использовать тот или иной репозиторий, информацию о нем необходимо поместить в папку `/etc/yum.repos.d/`

После того как отредактирован список репозиториев в `sources.list`, необходимо обновить локальную базу данных DNF о доступных пакетах. Это делается командой:

```Linux
dnf update
```

При выборе пакетов для установки DNF руководствуется всеми доступными репозиториями вне зависимости от способа доступа к ним. Так, если в репозитории, доступном по сети Интернет, обнаружена более новая версия программы, чем на компакт-диске, то DNF начнёт загружать данный пакет из сети Интернет.

Для создания репозитория, следуйте следующим указаниям:

* Установить пакет `createrepo`:

```Linux
dnf install createrepo
```

* Скопировать все пакеты в один каталог, например `/mnt/local_repo`.
* Запустить команду `createrepo --database`, указав этот каталог:

```Linux
createrepo --database /mnt/local_repo
```





## Механизм PAM

**Механизм PAM** (Pluggable Authentication Modules — подключаемые модули аутентификации) позволяет интегрировать различные низкоуровневые методы аутентификации и предоставить единые механизмы для использования прикладных программ в процессе аутентификации. Механизм состоит из набора разделяемых библиотек и конфигурационных файлов — сценариев процедур аутентификации.
В каталоге `/etc/pam.d` расположены конфигурационные файлы PAM для соответствующих сервисов, в т. ч. и для login (авторизованный вход в систему). В конфигурационном файле сервиса дана информация по проведению аутентификации.

Модули PAM вызываются при выполнении следующих функций:
1.	`auth` — аутентификация;
2.	`account` — получение привилегий доступа;
3.	`password` — управление паролями;
4.	`session` — сопровождение сессий.

Для выполнения каждой функции может быть перечислено несколько модулей PAM, которые будут вызываться последовательно, образуя стек PAM для данной задачи. Каждый вызываемый модуль возвращает в стек результат своей работы: или успешный (`PAM_SUCCESS`), или неуспешный (`PAM_AUTH_ERR`), или игнорирующий (`PAM_IGNORE`), или иной. Для каждого вызова может быть указан набор управляющих флагов в виде соответствия кода возврата и того, как результат работы модуля скажется на обработке всей сервисной задачи, например `ignore`, `ok`, `die`. Для управления аутентификацией используются следующие флаги:

* `requisite` — немедленное прекращение дальнейшего выполнения сервисной задачи с общим неуспешным результатом в случае неуспешного результата выполнения данного модуля;
* `required` — требование удачного выполнения этого модуля одновременно с выполнением всех остальных, перечисленных в данной сервисной задаче;
* `sufficient` — немедленное прекращение дальнейшего выполнения сервисной задачи с общим позитивным результатом, в случае позитивного результата выполнения данного модуля и всех предыдущих с флагом required в стеке задачи, если же модуль вернул негативный результат, то его значение игнорируется;
* `optional` — выполнение данного модуля никак не сказывается на результате всей задачи, но играет дополнительную информационную роль.





## Доверенная аутентификация Kerberos

Kerberos является протоколом, обеспечивающим централизованную аутентификацию пользователей и применяющим техническое маскирование данных для противодействия различным видам атак.
Основным компонентом системы Kerberos является центр распределения ключей (KDC). Программы, настроенные на взаимодействие с Kerberos, называются «керберизованными приложениями». KDC отвечает за аутентификацию в некоторой области Kerberos. В процессе работы система Kerberos выдает билеты (tickets) на использование различных служб.

Сервером Kerberos называется компьютер, на котором выполняется серверная программа Kerberos, или сама программа KDC. Клиент Kerberos — это компьютер или программа, которые получают билет от сервера Kerberos. Обычно действия системы Kerberos инициирует пользователь, отправляющий запрос на получение услуг от некоторого сервера приложения (например, сервера почты). Kerberos предоставляет билеты принципалам, в роли которых выступают пользователи или серверные программы. Для описания принципала применяется идентификатор, состоящий из трех компонентов: основы (primary), экземпляра (instance) и области (realm). Данный идентификатор имеет вид: `основа/экземпляр@область`

Система Kerberos выполняет следующие задачи:
1.	**обеспечение аутентификации в сети**. Для предотвращения НСД к службам сервер должен иметь возможность идентифицировать пользователей. Кроме того, в некоторых средах важно, чтобы клиент мог идентифицировать серверы. Это исключит работу пользователей с фальшивыми серверами, созданными для незаконного сбора конфиденциальной информации;
2.	**защиту паролей**. Открытость паролей, используемых в ряде сетевых служб, создает угрозу безопасности системы, т. к. они могут быть перехвачены и использованы для незаконного доступа к системе. Для решения данной проблемы используется техническое маскирование билетов Kerberos. Технология Kerberos представляет собой механизм аутентификации пользователей и сервисов, основным достоинством которой является повышенная защищенность при использовании в сети, которая достигается механизмом защищенного обмена билетами между пользователями, сервисами и сервером учетных записей Kerberos. При данном механизме пароли пользователей по сети не передаются, что обеспечивает повышенную защищенность от сетевых атак. С помощью механизма открытых и закрытых ключей, а также синхронизации часов клиентских компьютеров с сервером Kerberos обеспечивается уникальность билетов и их защищенность от подделки. В ОС используется реализация MIT Kerberos;
3.	**обеспечение однократной регистрации в сети**. Система Kerberos дает возможность пользователю работать с сетевыми сервисами, пройдя лишь единожды аутентификацию на своем компьютере. При этом для обмена с приложениями дополнительно вводить пароль не требуется. Локальные системы учетных записей пользователей и система ЕПП существуют в ОС параллельно. Различие между ними проводится с помощью разграничения диапазонов UID (значения UID меньшие, чем 2500, относятся к локальным пользователям, а большие или равные 2500 — к пользователям ЕПП).





## Администрирование ИС ФИП

Администратору ИС ФИП доступны следующие функции:

* управление функционалом пользователей ИС ФИП, включая представителей (операторов) ФИП, членов Координационного органа по вопросам формирования и функционирования инновационной инфраструктуры в системе образования, информационная поддержка экспертов, участвующих в экспертизе заявок на конкурс на получение статуса ФИП и отчетов ФИП;
* модерация новостей, событий, включая техническое сопровождение проведения сетевых событий с приглашением ФИП, имеющих лучшие практики и результаты осуществления инновационной деятельности, межрегиональных и дистанционных семинаров, мероприятий и публикаций ФИП, включая публикации новостей и результатов проектной деятельности ФИП в форме отчетной информации в библиотеке ИС ФИП;
* техническое и консультационное сопровождение ИС ФИП;
* координация процедур размещения материалов пользователями ИС ФИП, проверка безопасности прикрепляемых материалов, координация процедур размещения в ИС ФИП информации и программ проводимых семинаров, методических материалов и раздаточных материалов по лучшим моделям осуществления инновационной деятельности. Возможность проверки, мониторинга, поиска и удаления размещенной пользователями ИС ФИП информации, не соответствующей действующему законодательству Российской Федерации в системе образования и не относящейся к тематике разделов ИС ФИП;
* назначение экспертов при оценке заявок организаций-соискателей на конкурс на получение статуса ФИП, отчетов ФИП.

Процессы администратора ИС ФИП
1.	Администратор ИС ФИП имеет возможность добавлять, редактировать, удалять, блокировать пользователей.
2.	Администратор ИС ФИП имеет возможность редактировать, скрывать, удалять информацию содержащую новости, события и публикации.
3.	Администратору ИС ФИП доступны разделы для назначения экспертов на проверку заявок на получение статуса ФИП и годового отчета.
4.	Администратору ИС ФИП доступны разделы для просмотра заявок на получение статуса ФИП и годового отчета.





## Режим низкой скорости соединения
Режим низкой скорости соединения предназначен для использования системы по медленным каналам связи (например, через GPRS-модем). Скорость работы и размер трафика оптимизируются за счет уменьшения количества обращений к серверу и отказа от передачи несущественной информации. Скорость соединения устанавливается в диалогах добавления и редактирования информационной базы, в параметрах информационной базы при запуске клиента (подробнее см. раздел «Установка скорости соединения». Внешне установка режима низкой скорости соединения проявляется в виде отсутствия картинок разделов на панели разделов. При начале работы показываются команды рабочего стола и пустая рабочая область, на которой содержится гиперссылка Показать рабочий стол. Если необходима работа с формами рабочего стола, нужно открыть его по этой ссылке. При работе с данными в режиме низкой скорости следует учитывать, что оповещение сервера о закрытии формы, которая заблокировала данные, посылается через 20 секунд или одновременно с запросом об открытии другой формы. В этом режиме при выборе из списков в поле ввода и при вводе по строке данные будут считываться из базы данных не каждый раз, а по возможности будут использоваться ранее полученные данные. Если в базе появились новые данные и их нужно выбрать, а они еще не отображаются в списке, то нужно повторить выбор в поле ввода (повторно нажать кнопку выбора без перехода в другое поле) или обновить список (командой Обновить или клавишей F5 в форме списка выбора). Также в поле ввода при вводе с клавиатуры всплывающий список автоматически не открывается. Чтобы открыть его, следует нажать клавишу Стрелка вниз.





## Изменение структуры отчета
Элементами отчета в системе компоновки данных могут быть группировка, таблица, диаграмма, а также вложенный отчет. Группировка – выводит данные в виде списка. Чтобы добавить группировку в отчет, нужно выбрать пункт Добавить – Новая группировка или нажать клавишу Ins. В появившемся окне выбрать поле и тип группировки, как показано на рисунке. Если поле группировки не выбрано, то в отчет будут добавлены детальные записи – записи, полученные из базы данных в том порядке, в каком они расположены в базе. В простейшем случае после добавления группировки по полю Товар отчет примет вид, как на рисунке ниже.

> **СОВЕТ**. Также можно выбрать элементы структуры, которые требуется сгруппировать, и выбрать команду Все действия – Сгруппировать.

Команда Разгруппировать удаляет группировку, оставляя ее содержимое. Таблица – выводит данные в виде таблицы. Чтобы добавить таблицу в структуру, нужно выбрать пункт Добавить – Новая таблица. В качестве строк и колонок таблицы используются группировки. Например, в структуре отчета может быть создана таблица, строками которой является список товаров, а в колонках отображаются данные о количестве товаров на складе. Диаграмма – отображает данные в виде диаграммы. Чтобы добавить диаграмму в структуру, нужно выбрать пункт Добавить – Новая диаграмма. В зависимости от типа диаграммы необходимо добавить точки и серии. В качестве значений диаграммы будут использованы выбранные ресурсы. Вложенный отчет – если при создании отчета на этапе конфигурирования для него был создан вложенный отчет, то он также может быть использован в структуре отчета в качестве элемента.

> **СОВЕТ**. Наиболее часто используемые команды для работы со структурой отчета также можно вызывать из контекстного меню поля Структуры.

Чтобы удалить элемент из структуры, нужно выбрать его в поле структуры и нажать кнопку Удалить элемент или клавишу Del.





## Пользовательские сценарии использования телефонии

1.	Входящий звонок на АТС на внутренний номер конкретного пользователя должен показывать карточку звонка у сотрудника в Битрикс24, метод telephony.externalcall.register.
2.	Входящий звонок с неизвестного номера, не зарегистрированного в CRM, должен попадать в очередь обработки из списка пользователей, которые должны отвечать на входящие звонки:

* Одновременная очередь: всем сотрудникам, которые не отвечают на другие звонки в данный момент, одновременно показывается карточка звонка, когда кто-то из них начинает отвечать на звонок, у остальных карточка пропадает. Сначала используем telephony.externalcall.register для первого в очереди, затем telephony.externalcall.show для остальных.
* Последовательная очередь: каждому из сотрудников очереди, которые не отвечают на другие звонки в данный момент, показывается карточка звонка на какое-то время, 3-5-7 секунд. Если сотрудник не начинает отвечать на звонок, карточка у него пропадает, и звонок переводится на следующего в очереди. Сначала используем telephony.externalcall.register для первого в очереди, затем telephony.externalcall.hide и telephony.externalcall.show для следующего.

3.	Входящий звонок с известного номера в виде карточки звонка отображается в Битрикс24 у менеджера, ответственного за соответствующий объект CRM. Сначала telephony.externalcall.register с SHOW = 0, который вернет либо CREATED_LEAD в случае, если телефон не был найден в CRM и был создан новый лид, либо пару CRM_ENTITY_TYPE и CRM_ENTITY_ID с указанием найденного существующего клиента. Одновременно возвращается CRM_ACTIVITY_ID с идентификатором нового дела в CRM, в котором будет зафиксирован звонок в дальнейшем. Зная идентификатор объекта в CRM, можно при помощи методов по работе с CRM получить идентификатор менеджера, который отвечает за клиента, перевести звонок на него и показать ему карточку звонка telephony.externalcall.show.
4.	Сотрудник в Битрикс24 нажимает на номер телефона в интерфейсе CRM. Приложение инициирует исходящий звонок на указанный номер на стороне АТС, событие onexternalcallstart, сотруднику показывается карточка звонка telephony.externalcall.register.
5.	Звонок завершен, входящий или исходящий. Факт звонка и запись фиксируется в привязке к объекту CRM telephony.externalcall.finish. Если на момент завершения звонка в АТС еще не готова запись разговора, то вместо telephony.externalcall.finish сначала просто скрываем карточку звонка telephony.externalcall.hide, а уже потом, когда запись готова, вызываем telephony.externalcall.finish.
6.	На стороне АТС произошел входящий звонок в тот момент, когда связи между АТС и Битрикс24 по каким-то причинам нет. После восстановления связи информация о произошедшем звонке фиксируется в Битрикс24, пункты 1-3, но без показа карточки звонка – последовательный вызов методов telephony.externalcall.register с параметром SHOW = 0 и telephony.externalcall.finish.





## Бизнес-процессы в «1С:Предприятии»

Бизнес-процессы в «1С:Предприятии» предназначены для объединения отдельных операций в цепочки взаимосвязанных действий, приводящих к достижению конкретной цели. Например, цепочку по выписке счета, приему наличной оплаты и отпуску товара со склада можно представить как бизнес-процесс Продажа товара. Цепочки взаимосвязанных действий бизнес-процесса представляются с помощью карты маршрута бизнес-процесса. Карта маршрута описывает логику бизнес-процесса и весь его жизненный цикл от точки старта до точки завершения в виде схематического изображения последовательности прохождения взаимосвязанных точек маршрута. Точка маршрута отражает этап жизненного цикла бизнес-процесса, связанный с выполнением, как правило, одной автоматической или ручной операции. Задачи в «1С:Предприятии» позволяют вести учет заданий по исполнителям и служат отражением продвижения бизнес-процессов по точкам маршрута. При этом задачи могут создаваться не только бизнес-процессами, но и другими объектами информационной базы и непосредственно пользователями. При переходе бизнес-процесса на какую–либо точку маршрута, предусматривающую действия конкретного исполнителя, формируется задача (или несколько задач в случае группового действия). После того как исполнитель отметит задачу как выполненную, бизнес-процесс автоматически переходит к следующей точке маршрута в соответствии с картой. Таким образом, задачи являются движущей силой бизнеспроцессов. Описание конкретных бизнес-процессов и их взаимосвязи с задачами приводится в описании конфигурации. Общие принципы работы с бизнес-процессами и задачами аналогичны работе с другими объектами (например, документами и списками), поэтому в данном руководстве будут описаны только особенности. 





## Ограничения на интенсивность запросов

Лимит на интенсивность запросов к Битрикс24 реализован по принципу Leaky Bucket Algorithm. Это позволяет, с одной строны, разрешить приложениям кратковременно выполнять запросы очень интенсивно, а с другой стороны, не позволяет делать это постоянно.

Работает это следующим образом:
1.	Каждый входящий запрос от приложения увеличивает условный "счетчик запросов" на стороне Битрикс24
2.	Как только значение "счетчика" превышает пороговое значение Х, каждый следующий входящий запрос блокируется. Приложение в ответ получает статус 503 с кодом ошибки QUERY_LIMIT_EXCEEDED
3.	Параллельно значение счетчика автоматически уменьшается на Y раз в секунду

Из логики этого механизма следует два вывода:
1.	Если ваше приложение будет делать не более Y запросов в секунду, то оно никогда не столкнется с ошибкой QUERY_LIMIT_EXCEEDED
2.	Если специфика вашего приложения требует кратковременно делать много запросов - это возможно. Нет такого ограничения "нельзя выполнять больше Y запросов в секунду". Можно делать достаточно много запросов в секунду, просто не получится это делать постоянно. Например, так происходит в интеграциях с телефониями, когда по независящим от приложения причинам вдруг случается несколько входящих звонков сразу.
Пороговые значения Х и Y, о которых шла речь выше, зависят от тарифного плана.





## Электронно-цифровая подпись для обмена документами с 1С-Битрикс

Итак, первое, что нужно сделать - это приобрести сертификат усиленной квалифицированной электронной подписи. За квалифицированной подписью нужно обращаться только в аккредитованный Минкомсвязью РФ удостоверяющий центр (УЦ), список которых размещен на сайте: https://digital.gov.ru/ru/activity/govservices/certification_authority.

Фактически, для использования ЭЦП нужно четыре составляющие:

### Инструмент №1 — сертификат ЭП и закрытый ключ к нему
Эти элементы можно получить в удостоверяющем центре (УЦ). Они хранятся на защищенном носителе, который внешне выглядит как флеш-накопитель, но на самом деле является специализированным электронным устройством, обеспечивающим безопасное хранение закрытого ключа пользователя и сертификата ЭП. Этот носитель называется токеном. При осуществлении криптографических операций криптопровайдер обращается к защищенному носителю для получения доступа к закрытому ключу ЭП.
Токены на российском рынке выпускают различные производители. Флагманами считаются Рутокен (компания «Актив»), JaСarta (компания «Аладдин Р.Д.»).

### Инструмент №2 — криптопровайдер
Это специальное ПО, реализующее все криптографические алгоритмы. Оно дает инструментарий для их использования: чтобы создавать ЭП, проверять ее, зашифровывать и расшифровывать информацию. Одни из самых известных криптопровайдеров — КриптоПро CSP и ViPNet CSP.

### Инструмент №3 — настроенное рабочее место
Основной вопрос касается установки корневых сертификатов УЦ, выдавшего сертификат ЭП. При работе с квалифицированными сертификатами ЭП настройка корневых сертификатов часто связана с дополнительной задачей — установкой кросс-сертификатов Минкомсвязи. Такие сертификаты позволяют удостовериться в том, что УЦ действительно аккредитован, так как в требованиях к квалифицированной ЭП указано, что она обязательно должна быть выдана аккредитованным УЦ.

### Инструмент №4 — настроенный браузер
При работе с площадками и системами с веб-доступом необходимо настроить браузер таким образом, чтобы он позволял осуществлять все необходимые операции. Если мы попробуем начать работу с браузером, настроенным по умолчанию, то работа с ЭП будет недоступна из-за политик безопасности операционной системы. Также часто требуется установка дополнительных надстроек или плагинов для браузера.

Если перечисленные пункты показались вам сложными, то хочется успокоить вас тем, что большинство удостоверяющих центров предлагают получить весь необходимый пакет ПО вместе с ЭЦП. Не стоит заранее пугаться - очень многие компании в России, даже не обладая специалистами по IT, прекрасно используют ЭЦП для общения с различными государственными органами.





## Просмотр справочной информации

Для поиска нужной главы можно воспользоваться содержанием. Для этого в окне Справка следует нажать кнопку Содержание. В левой части окна появится дерево глав содержания.

Дерево глав строится автоматически и включает в себя системную справку и справку по использованию конфигурации. Также справка может содержать информацию по работе с конкретными разделами программы. Для удобства просмотра все дерево или отдельные ветви можно развернуть и свернуть. Пиктограмма + (плюс) в узле ветви указывает, что эту ветвь можно развернуть. Для этого достаточно нажать пиктограмму или дважды нажать мышью наименование главы, расположенное возле пиктограммы. Ветвь откроет для просмотра следующий уровень, а пиктограмма + (плюс) изменится на - (минус). Свернуть ветвь дерева можно щелчком мыши на пиктограмме - (минус). Чтобы развернуть сразу все ветви дерева, нужно выбрать клавишами или мышью наименование главы корневой ветки дерева и нажать клавишу * (звездочка на цифровой клавиатуре), которая расположена на цифровой клавиатуре. На первом уровне в дереве располагаются названия разделов. Последовательно разворачивая ветви дерева глав, можно перейти к описанию конкретного элемента данных. Для перемещения по главам описания можно использовать дерево глав или кнопки панели управления окна Справка. Чтобы просмотреть текст интересующей главы в дереве, следует выбрать наименование главы мышью или с помощью клавиш управления курсором и нажать клавишу Enter. В окне просмотра отобразится текст выбранной главы. Для перемещения по тексту описания можно использовать клавиши управления курсором и клавиши PgDn и PgUp. При значительном объеме текста можно использовать линейки прокрутки, расположенные справа и внизу окна, для вывода на экран невидимой части описания.

Кнопки командной панели окна Справка позволяют быстро перемещаться от одной главы к другой. Кнопкой Переход к следующему осуществляется переход к следующей по порядку главе. В дереве глав при необходимости будет открыта соответствующая ветвь, а выделение будет перемещаться по названиям глав, показывая текущее положение в дереве. Для перехода к предыдущей по порядку главе используется кнопка Переход к предыдущему. После того как глава описания найдена и окно справки открыто, для поиска положения главы в дереве описаний используется кнопка командной панели Найти текущий элемент в дереве. Если в процессе просмотра выбирались несколько страниц, то с помощью команд Переход вперед, Переход назад, и История можно вернуться к просмотренным страницам. Программа сохраняет историю просмотра справочных глав. Для возврата на предыдущую просмотренную главу или для перехода на следующую просмотренную главу в истории используются кнопки истории переходов.





## Локальные приложения
Локальными называются приложения, которые описываются и добавляются непосредственно на конкретном Битрикс24. Именно в этом суть термина «локальный»
Администратор портала решает, какие права дать такому приложению и как оно будет называться в интерфейсе.

Существует два вида таких приложений:

* "Статичные" приложения на основе HTML/JS. Фактически, на основе этих технологий вы можете реализовывать приложения-одностраничники, обращаясь к REST API Б24 при помощи SDK на JS. В интерфейсе они представлены в виде отдельной страницы (со ссылкой из левого меню). Статичные приложения не могут получать события Битрикс24.
* "Серверные" приложения с back-end на любых подходящих языках программирования (PHP, Python, и другие). Они могут обращаться к REST API, используя протокол OAuth 2.0, а также получать события от Битрикс24 в свои обработчики. Представлены в интерфейсе в виде отдельной страницы, а также в виде встраиваемых popup-диалогов в доступных для встраивания объектах Битрикс24. Есть вариант, когда приложение никак не проявляет себя в интерфейсе, но использует REST.